#!/bin/bash
# ะกะบัะธะฟั ัะฐะทะฒะตัััะฒะฐะฝะธั ะฑะพัะฐ

set -e

echo "๐ ะะฐะทะฒะตัััะฒะฐะฝะธะต Telegram ะฑะพัะฐ ะะธะทัะฐะฟั"
echo "======================================"

# ะัะพะฒะตัะบะฐ ะฝะฐะปะธัะธั .env
if [ ! -f .env ]; then
    echo "โ ะคะฐะนะป .env ะฝะต ะฝะฐะนะดะตะฝ!"
    echo "๐ ะกะพะทะดะฐะนัะต ะตะณะพ ะฝะฐ ะพัะฝะพะฒะต .env.example:"
    echo "   cp .env.example .env"
    echo "   nano .env"
    exit 1
fi

# ะะฝะธัะธะฐะปะธะทะฐัะธั ะดะฐะฝะฝัั
echo "๐ ะะฝะธัะธะฐะปะธะทะฐัะธั ะฑะฐะทั ะดะฐะฝะฝัั..."
./init_data.sh

# ะััะฐะฝะพะฒะบะฐ ััะฐััั ะบะพะฝัะตะนะฝะตัะพะฒ
echo "๐ ะััะฐะฝะพะฒะบะฐ ััะฐััั ะบะพะฝัะตะนะฝะตัะพะฒ..."
docker-compose down 2>/dev/null || true

# ะกะฑะพัะบะฐ ะพะฑัะฐะทะฐ
echo "๐จ ะกะฑะพัะบะฐ Docker ะพะฑัะฐะทะฐ..."
docker-compose build --no-cache

# ะะฐะฟััะบ
echo "โถ๏ธ  ะะฐะฟััะบ ะฑะพัะฐ..."
docker-compose up -d

# ะัะพะฒะตัะบะฐ ััะฐัััะฐ
echo ""
echo "โ ะะฐะทะฒะตัััะฒะฐะฝะธะต ะทะฐะฒะตััะตะฝะพ!"
echo ""
echo "๐ ะกัะฐััั ะบะพะฝัะตะนะฝะตัะฐ:"
docker-compose ps

echo ""
echo "๐ ะัะพัะผะพัั ะปะพะณะพะฒ: docker-compose logs -f"
echo "๐ ะััะฐะฝะพะฒะบะฐ ะฑะพัะฐ: docker-compose down"
echo "๐ ะะตัะตะทะฐะฟััะบ: docker-compose restart"
